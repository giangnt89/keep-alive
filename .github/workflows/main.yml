name: Daily Log Commit

on:
  schedule:
    - cron: '30 13 * * *'  # 22h giá» Viá»‡t Nam (UTC+7)
  workflow_dispatch:

jobs:
  daily-log:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout with write permission
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create daily log
        run: |
          mkdir -p logs
          NOW=$(date '+%Y-%m-%d')
          FILE="logs/${NOW}-log.txt"

          echo "â³ Äang táº¡o log giáº£ láº­p táº¡i $FILE"

          ACTIONS=("created" "updated" "deleted")
          LINES=$((RANDOM % 901 + 100))  # Ngáº«u nhiÃªn tá»« 100â€“1000 dÃ²ng

          for i in $(seq 1 $LINES); do
            # Táº¡o giá» phÃºt giÃ¢y ngáº«u nhiÃªn trong ngÃ y
            TIME=$(date -d "$((RANDOM % 86400)) seconds" +%H:%M:%S)

            # Táº¡o user ID ngáº«u nhiÃªn tá»« 1â€“100000 vá»›i Ä‘á»‹nh dáº¡ng user_000123
            USER_RAW_ID=$(( (RANDOM * RANDOM) % 100000 + 1 ))
            printf -v USER_ID "user_%06d" "$USER_RAW_ID"

            # Chá»n hÃ nh Ä‘á»™ng ngáº«u nhiÃªn
            ACTION=${ACTIONS[$RANDOM % ${#ACTIONS[@]}]}

            # Ghi log
            echo "$NOW $TIME $USER_ID Ä‘Ã£ $ACTION resv thÃ nh cÃ´ng" >> "$FILE"
          done

      - name: Commit and push
        run: |
          git config user.name "giang89"
          git config user.email "truonggiang92qn@gmail.com"
          git add logs/
          git commit -m "ğŸ“ Daily log for $(date '+%Y-%m-%d')" || echo "KhÃ´ng cÃ³ gÃ¬ Ä‘á»ƒ commit"
          git pull --rebase
          git push
